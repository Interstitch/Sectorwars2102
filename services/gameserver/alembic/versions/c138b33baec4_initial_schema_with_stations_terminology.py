"""initial schema with stations terminology

Revision ID: c138b33baec4
Revises: 
Create Date: 2025-11-16 18:16:46.852027

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'c138b33baec4'
down_revision = None
branch_labels = None
depends_on = None


def upgrade() -> None:
    # Disable FK constraint checking for initial schema creation (circular dependencies)
    op.execute("SET session_replication_role = 'replica';")

    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('ai_model_performance',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('model_name', sa.String(length=100), nullable=False),
    sa.Column('model_version', sa.String(length=50), nullable=False),
    sa.Column('performance_date', sa.Date(), nullable=False),
    sa.Column('total_predictions', sa.Integer(), nullable=False),
    sa.Column('correct_predictions', sa.Integer(), nullable=False),
    sa.Column('accuracy_percentage', sa.Numeric(precision=5, scale=2), nullable=False),
    sa.Column('average_confidence', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('user_acceptance_rate', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('average_user_satisfaction', sa.Numeric(precision=3, scale=2), nullable=True),
    sa.Column('profit_improvement_rate', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('performance_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('audit_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('timestamp', sa.DateTime(), nullable=False),
    sa.Column('method', sa.String(length=10), nullable=False),
    sa.Column('path', sa.String(length=255), nullable=False),
    sa.Column('status_code', sa.Integer(), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('user_id', sa.UUID(), nullable=True),
    sa.Column('user_type', sa.String(length=20), nullable=True),
    sa.Column('client_ip', sa.String(length=45), nullable=False),
    sa.Column('user_agent', sa.Text(), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=True),
    sa.Column('resource_type', sa.String(length=50), nullable=True),
    sa.Column('resource_id', sa.UUID(), nullable=True),
    sa.Column('query_params', sa.JSON(), nullable=True),
    sa.Column('request_body', sa.JSON(), nullable=True),
    sa.Column('response_summary', sa.Text(), nullable=True),
    sa.Column('security_flags', sa.JSON(), nullable=True),
    sa.Column('violation_detected', sa.String(length=100), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_audit_logs_action'), 'audit_logs', ['action'], unique=False)
    op.create_index(op.f('ix_audit_logs_path'), 'audit_logs', ['path'], unique=False)
    op.create_index(op.f('ix_audit_logs_timestamp'), 'audit_logs', ['timestamp'], unique=False)
    op.create_index(op.f('ix_audit_logs_user_id'), 'audit_logs', ['user_id'], unique=False)
    op.create_table('factions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('faction_type', sa.Enum('Federation', 'Independents', 'Pirates', 'Merchants', 'Explorers', 'Military', name='factiontype'), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('territory_sectors', sa.ARRAY(sa.UUID()), nullable=True),
    sa.Column('home_sector_id', sa.UUID(), nullable=True),
    sa.Column('base_pricing_modifier', sa.Float(), nullable=True),
    sa.Column('trade_specialties', sa.ARRAY(sa.String()), nullable=True),
    sa.Column('aggression_level', sa.Integer(), nullable=True),
    sa.Column('diplomacy_stance', sa.String(length=50), nullable=True),
    sa.Column('color_primary', sa.String(length=7), nullable=True),
    sa.Column('color_secondary', sa.String(length=7), nullable=True),
    sa.Column('logo_url', sa.String(length=255), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_factions_name'), 'factions', ['name'], unique=True)
    op.create_table('galaxies',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('statistics', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('density', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('faction_influence', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('state', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('events', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('expansion_enabled', sa.Boolean(), nullable=False),
    sa.Column('max_sectors', sa.Integer(), nullable=False),
    sa.Column('resources_regenerate', sa.Boolean(), nullable=False),
    sa.Column('warp_shifts_enabled', sa.Boolean(), nullable=False),
    sa.Column('default_turns_per_day', sa.Integer(), nullable=False),
    sa.Column('combat_penalties', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('economic_modifiers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('hidden_sectors', sa.Integer(), nullable=False),
    sa.Column('special_features', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('genesis_devices',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('serial_number', sa.String(length=50), nullable=False),
    sa.Column('type', sa.Enum('STANDARD', 'ENHANCED', 'SPECIALIZED', 'ADVANCED', 'EXPERIMENTAL', 'QUANTUM', name='genesis_type'), nullable=False),
    sa.Column('status', sa.Enum('INACTIVE', 'DEPLOYING', 'ACTIVE', 'COMPLETED', 'FAILED', 'UNSTABLE', 'ABORTED', name='genesis_status'), nullable=False),
    sa.Column('owner_id', sa.UUID(), nullable=False),
    sa.Column('creator_faction', sa.String(), nullable=True),
    sa.Column('ship_id', sa.UUID(), nullable=True),
    sa.Column('sector_id', sa.Integer(), nullable=True),
    sa.Column('planet_id', sa.UUID(), nullable=True),
    sa.Column('deployed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('terraforming_power', sa.Integer(), nullable=False),
    sa.Column('terraforming_types', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('resource_generation', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('special_features', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('phase', sa.Integer(), nullable=False),
    sa.Column('total_phases', sa.Integer(), nullable=False),
    sa.Column('progress', sa.Float(), nullable=False),
    sa.Column('estimated_completion', sa.DateTime(timezone=True), nullable=True),
    sa.Column('resource_consumption', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('stability', sa.Float(), nullable=False),
    sa.Column('failure_chance', sa.Float(), nullable=False),
    sa.Column('security_level', sa.Integer(), nullable=False),
    sa.Column('access_code', sa.String(), nullable=True),
    sa.Column('result_planet_type', sa.String(), nullable=True),
    sa.Column('result_planet_quality', sa.Float(), nullable=True),
    sa.Column('result_resources', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('result_special_features', postgresql.ARRAY(sa.String()), nullable=True),
    # FK constraints deferred to after all tables created (circular dependency)
    # sa.ForeignKeyConstraint(['owner_id'], ['players.id'], ),
    # sa.ForeignKeyConstraint(['planet_id'], ['planets.id'], ),
    # sa.ForeignKeyConstraint(['ship_id'], ['ships.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('serial_number')
    )
    op.create_table('languages',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=10), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('native_name', sa.String(length=100), nullable=False),
    sa.Column('direction', sa.String(length=3), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('completion_percentage', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_languages_code'), 'languages', ['code'], unique=True)
    op.create_table('planets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('sector_id', sa.Integer(), nullable=False),
    sa.Column('sector_uuid', sa.UUID(), nullable=True),
    sa.Column('owner_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('type', sa.Enum('TERRAN', 'DESERT', 'OCEANIC', 'ICE', 'VOLCANIC', 'GAS_GIANT', 'BARREN', 'JUNGLE', 'ARCTIC', 'TROPICAL', 'MOUNTAINOUS', 'ARTIFICIAL', name='planet_type'), nullable=False),
    sa.Column('status', sa.Enum('UNINHABITABLE', 'HABITABLE', 'COLONIZED', 'DEVELOPED', 'TERRAFORMING', 'DYING', 'RESTRICTED', name='planet_status'), nullable=False),
    sa.Column('size', sa.Integer(), nullable=False),
    sa.Column('position', sa.Integer(), nullable=False),
    sa.Column('gravity', sa.Float(), nullable=False),
    sa.Column('planet_type', sa.String(length=50), nullable=True),
    sa.Column('specialization', sa.String(length=50), nullable=True),
    sa.Column('atmosphere', sa.String(), nullable=True),
    sa.Column('temperature', sa.Float(), nullable=False),
    sa.Column('water_coverage', sa.Float(), nullable=False),
    sa.Column('habitability_score', sa.Integer(), nullable=False),
    sa.Column('radiation_level', sa.Float(), nullable=False),
    sa.Column('resource_richness', sa.Float(), nullable=False),
    sa.Column('resources', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('special_resources', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('fuel_ore', sa.Integer(), nullable=False),
    sa.Column('organics', sa.Integer(), nullable=False),
    sa.Column('equipment', sa.Integer(), nullable=False),
    sa.Column('fighters', sa.Integer(), nullable=False),
    sa.Column('colonized_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('population', sa.Integer(), nullable=False),
    sa.Column('max_population', sa.Integer(), nullable=False),
    sa.Column('population_growth', sa.Float(), nullable=False),
    sa.Column('colonists', sa.Integer(), nullable=False),
    sa.Column('max_colonists', sa.Integer(), nullable=False),
    sa.Column('fuel_allocation', sa.Integer(), nullable=False),
    sa.Column('organics_allocation', sa.Integer(), nullable=False),
    sa.Column('equipment_allocation', sa.Integer(), nullable=False),
    sa.Column('economy', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('production', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('production_efficiency', sa.Float(), nullable=False),
    sa.Column('factory_level', sa.Integer(), nullable=False),
    sa.Column('farm_level', sa.Integer(), nullable=False),
    sa.Column('mine_level', sa.Integer(), nullable=False),
    sa.Column('research_level', sa.Integer(), nullable=False),
    sa.Column('defense_level', sa.Integer(), nullable=False),
    sa.Column('shields', sa.Integer(), nullable=False),
    sa.Column('weapon_batteries', sa.Integer(), nullable=False),
    sa.Column('defense_turrets', sa.Integer(), nullable=False),
    sa.Column('defense_shields', sa.Integer(), nullable=False),
    sa.Column('defense_fighters', sa.Integer(), nullable=False),
    sa.Column('last_attacked', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_production', sa.DateTime(timezone=True), nullable=True),
    sa.Column('active_events', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('under_siege', sa.Boolean(), nullable=False),
    sa.Column('siege_started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('siege_attacker_id', sa.UUID(), nullable=True),
    sa.Column('genesis_created', sa.Boolean(), nullable=False),
    sa.Column('genesis_device_id', sa.UUID(), nullable=True),
    sa.Column('region_id', sa.UUID(), nullable=True),
    # FK constraints deferred (circular dependencies)
    # sa.ForeignKeyConstraint(['genesis_device_id'], ['genesis_devices.id'], ),
    # sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    # sa.ForeignKeyConstraint(['sector_uuid'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('players',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('nickname', sa.String(length=50), nullable=True),
    sa.Column('credits', sa.Integer(), nullable=False),
    sa.Column('turns', sa.Integer(), nullable=False),
    sa.Column('reputation', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('current_ship_id', sa.UUID(), nullable=True),
    sa.Column('home_sector_id', sa.Integer(), nullable=False),
    sa.Column('current_sector_id', sa.Integer(), nullable=False),
    sa.Column('is_ported', sa.Boolean(), nullable=False),
    sa.Column('is_landed', sa.Boolean(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=True),
    sa.Column('attack_drones', sa.Integer(), nullable=False),
    sa.Column('defense_drones', sa.Integer(), nullable=False),
    sa.Column('mines', sa.Integer(), nullable=False),
    sa.Column('insurance', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('last_game_login', sa.DateTime(timezone=True), nullable=True),
    sa.Column('turn_reset_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('settings', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('first_login', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('home_region_id', sa.UUID(), nullable=True),
    sa.Column('current_region_id', sa.UUID(), nullable=True),
    sa.Column('is_galactic_citizen', sa.Boolean(), nullable=False),
    # FK constraints deferred (circular dependencies)
    # sa.ForeignKeyConstraint(['current_region_id'], ['regions.id'], ),
    # sa.ForeignKeyConstraint(['current_ship_id'], ['ships.id'], ondelete='SET NULL'),
    # sa.ForeignKeyConstraint(['home_region_id'], ['regions.id'], ),
    # sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ondelete='SET NULL'),
    # sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_table('resources',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('type', sa.Enum('ORE', 'BASIC_FOOD', 'GOURMET_FOOD', 'FUEL', 'TECHNOLOGY', 'EXOTIC_TECHNOLOGY', 'LUXURY_GOODS', 'POPULATION', 'QUANTUM_SHARDS', 'QUANTUM_CRYSTALS', 'COMBAT_DRONES', 'PRISMATIC_ORE', 'PHOTONIC_CRYSTALS', name='resource_type'), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('base_value', sa.Integer(), nullable=False),
    sa.Column('quality', sa.Enum('LOW', 'STANDARD', 'HIGH', 'PREMIUM', 'EXOTIC', name='resource_quality'), nullable=False),
    sa.Column('value_multiplier', sa.Float(), nullable=False),
    sa.Column('weight', sa.Float(), nullable=False),
    sa.Column('trade_volume', sa.Integer(), nullable=False),
    sa.Column('price_volatility', sa.Float(), nullable=False),
    sa.Column('base_production_rate', sa.Float(), nullable=False),
    sa.Column('production_difficulty', sa.Integer(), nullable=False),
    sa.Column('special_attributes', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('required_technology', sa.String(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ship_rarity_configs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('ship_type', sa.Enum('SCOUT_SHIP', 'CARGO_HAULER', 'ESCAPE_POD', 'LIGHT_FREIGHTER', 'DEFENDER', 'FAST_COURIER', 'COLONY_SHIP', 'CARRIER', name='ship_type_config'), nullable=False),
    sa.Column('rarity_tier', sa.Integer(), nullable=False),
    sa.Column('spawn_chance', sa.Integer(), nullable=False),
    sa.Column('base_credits', sa.Integer(), nullable=False),
    sa.Column('weak_threshold', sa.Float(), nullable=False),
    sa.Column('average_threshold', sa.Float(), nullable=False),
    sa.Column('strong_threshold', sa.Float(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('ship_type')
    )
    op.create_table('ship_specifications',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('type', sa.Enum('ESCAPE_POD', 'LIGHT_FREIGHTER', 'CARGO_HAULER', 'FAST_COURIER', 'SCOUT_SHIP', 'COLONY_SHIP', 'DEFENDER', 'CARRIER', 'WARP_JUMPER', name='ship_type'), nullable=False),
    sa.Column('base_cost', sa.Integer(), nullable=False),
    sa.Column('speed', sa.Float(), nullable=False),
    sa.Column('turn_cost', sa.Integer(), nullable=False),
    sa.Column('max_cargo', sa.Integer(), nullable=False),
    sa.Column('max_colonists', sa.Integer(), nullable=False),
    sa.Column('max_drones', sa.Integer(), nullable=False),
    sa.Column('max_shields', sa.Integer(), nullable=False),
    sa.Column('shield_recharge_rate', sa.Float(), nullable=False),
    sa.Column('hull_points', sa.Integer(), nullable=False),
    sa.Column('evasion', sa.Integer(), nullable=False),
    sa.Column('genesis_compatible', sa.Boolean(), nullable=False),
    sa.Column('max_genesis_devices', sa.Integer(), nullable=False),
    sa.Column('warp_compatible', sa.Boolean(), nullable=False),
    sa.Column('warp_creation_capable', sa.Boolean(), nullable=False),
    sa.Column('quantum_jump_capable', sa.Boolean(), nullable=False),
    sa.Column('scanner_range', sa.Integer(), nullable=False),
    sa.Column('attack_rating', sa.Integer(), nullable=False),
    sa.Column('defense_rating', sa.Integer(), nullable=False),
    sa.Column('maintenance_rate', sa.Float(), nullable=False),
    sa.Column('construction_time', sa.Integer(), nullable=False),
    sa.Column('fuel_efficiency', sa.Integer(), nullable=False),
    sa.Column('max_upgrade_levels', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('special_abilities', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('acquisition_methods', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('faction_requirements', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('type')
    )
    op.create_table('ships',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('type', sa.Enum('ESCAPE_POD', 'LIGHT_FREIGHTER', 'CARGO_HAULER', 'FAST_COURIER', 'SCOUT_SHIP', 'COLONY_SHIP', 'DEFENDER', 'CARRIER', 'WARP_JUMPER', name='ship_type'), nullable=False),
    sa.Column('owner_id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('base_speed', sa.Float(), nullable=False),
    sa.Column('current_speed', sa.Float(), nullable=False),
    sa.Column('turn_cost', sa.Integer(), nullable=False),
    sa.Column('warp_capable', sa.Boolean(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('status', sa.Enum('DOCKED', 'IN_SPACE', 'IN_COMBAT', 'DESTROYED', 'MAINTENANCE', name='ship_status'), nullable=False),
    sa.Column('maintenance', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('cargo', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('has_cloaking', sa.Boolean(), nullable=False),
    sa.Column('genesis_devices', sa.Integer(), nullable=False),
    sa.Column('max_genesis_devices', sa.Integer(), nullable=False),
    sa.Column('mines', sa.Integer(), nullable=False),
    sa.Column('max_mines', sa.Integer(), nullable=False),
    sa.Column('has_automated_maintenance', sa.Boolean(), nullable=False),
    sa.Column('combat', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('upgrades', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('insurance', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_destroyed', sa.Boolean(), nullable=False),
    sa.Column('is_flagship', sa.Boolean(), nullable=False),
    sa.Column('purchase_value', sa.Integer(), nullable=False),
    sa.Column('current_value', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['owner_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('teams',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=80), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('leader_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('reputation_calculation_method', sa.String(length=20), nullable=False),
    sa.Column('tag', sa.String(length=10), nullable=True),
    sa.Column('logo', sa.String(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=False),
    sa.Column('max_members', sa.Integer(), nullable=False),
    sa.Column('sector_claims', postgresql.ARRAY(sa.Integer()), nullable=False),
    sa.Column('home_sector_id', sa.Integer(), nullable=True),
    sa.Column('recruitment_status', sa.String(length=20), nullable=False),
    sa.Column('treasury_credits', sa.Integer(), nullable=False),
    sa.Column('treasury_fuel', sa.Integer(), nullable=False),
    sa.Column('treasury_organics', sa.Integer(), nullable=False),
    sa.Column('treasury_equipment', sa.Integer(), nullable=False),
    sa.Column('treasury_technology', sa.Integer(), nullable=False),
    sa.Column('treasury_luxury_items', sa.Integer(), nullable=False),
    sa.Column('treasury_precious_metals', sa.Integer(), nullable=False),
    sa.Column('treasury_raw_materials', sa.Integer(), nullable=False),
    sa.Column('treasury_plasma', sa.Integer(), nullable=False),
    sa.Column('treasury_bio_samples', sa.Integer(), nullable=False),
    sa.Column('treasury_dark_matter', sa.Integer(), nullable=False),
    sa.Column('treasury_quantum_crystals', sa.Integer(), nullable=False),
    sa.Column('total_credits', sa.Integer(), nullable=False),
    sa.Column('total_planets', sa.Integer(), nullable=False),
    sa.Column('combat_rating', sa.Float(), nullable=False),
    sa.Column('trade_rating', sa.Float(), nullable=False),
    sa.Column('join_requirements', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('member_roles', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('resource_sharing', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('invitation_codes', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('translation_namespaces',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('application', sa.String(length=50), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_translation_namespaces_name'), 'translation_namespaces', ['name'], unique=True)
    op.create_table('users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('username', sa.String(length=50), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_admin', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_login', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted', sa.Boolean(), nullable=False),
    sa.Column('paypal_subscription_id', sa.String(length=255), nullable=True),
    sa.Column('subscription_tier', sa.String(length=50), nullable=True),
    sa.Column('subscription_status', sa.String(length=50), nullable=True),
    sa.Column('subscription_started_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('subscription_expires_at', sa.TIMESTAMP(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email'),
    sa.UniqueConstraint('username')
    )
    op.create_table('admin_credentials',
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('last_password_change', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('user_id')
    )
    op.create_table('ai_comprehensive_assistants',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('assistant_name', sa.String(length=50), nullable=False),
    sa.Column('personality_type', sa.String(length=20), nullable=False),
    sa.Column('learning_mode', sa.String(length=20), nullable=False),
    sa.Column('security_level', sa.String(length=20), nullable=False),
    sa.Column('encryption_key_id', sa.UUID(), nullable=True),
    sa.Column('access_permissions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('api_request_quota', sa.Integer(), nullable=False),
    sa.Column('api_requests_used', sa.Integer(), nullable=False),
    sa.Column('quota_reset_date', sa.Date(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_active', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('total_interactions', sa.BigInteger(), nullable=False),
    sa.Column('learning_sessions', sa.Integer(), nullable=False),
    sa.CheckConstraint("learning_mode IN ('conservative', 'balanced', 'aggressive', 'custom')", name='valid_learning_mode'),
    sa.CheckConstraint("personality_type IN ('analytical', 'friendly', 'tactical', 'cautious', 'adaptive')", name='valid_personality_type'),
    sa.CheckConstraint("security_level IN ('basic', 'standard', 'premium', 'enterprise')", name='valid_security_level'),
    sa.CheckConstraint('api_request_quota >= 100 AND api_request_quota <= 10000', name='quota_bounds'),
    sa.CheckConstraint('api_requests_used >= 0 AND api_requests_used <= api_request_quota', name='usage_bounds'),
    sa.CheckConstraint('total_interactions >= 0 AND learning_sessions >= 0', name='positive_counters'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id')
    )
    op.create_table('ai_recommendations',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('recommendation_type', sa.String(length=50), nullable=False),
    sa.Column('recommendation_data', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('confidence_score', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('expected_profit', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('risk_assessment', sa.String(length=20), nullable=False),
    sa.Column('reasoning', sa.Text(), nullable=True),
    sa.Column('priority_level', sa.Integer(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('accepted', sa.Boolean(), nullable=True),
    sa.Column('acceptance_timestamp', sa.DateTime(timezone=True), nullable=True),
    sa.Column('outcome_profit', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('outcome_timestamp', sa.DateTime(timezone=True), nullable=True),
    sa.Column('feedback_score', sa.Integer(), nullable=True),
    sa.Column('feedback_text', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('aria_personal_memories',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('memory_type', sa.String(length=50), nullable=False),
    sa.Column('importance_score', sa.Float(), nullable=True),
    sa.Column('confidence_level', sa.Float(), nullable=True),
    sa.Column('memory_content', sa.JSON(), nullable=False),
    sa.Column('memory_hash', sa.String(length=64), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_accessed', sa.DateTime(timezone=True), nullable=True),
    sa.Column('access_count', sa.Integer(), nullable=True),
    sa.Column('decay_rate', sa.Float(), nullable=True),
    sa.Column('current_strength', sa.Float(), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id', 'memory_hash', name='uq_player_memory_hash')
    )
    op.create_index('idx_aria_memory_importance', 'aria_personal_memories', ['importance_score'], unique=False)
    op.create_index('idx_aria_memory_player_type', 'aria_personal_memories', ['player_id', 'memory_type'], unique=False)
    op.create_table('aria_security_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('event_type', sa.String(length=50), nullable=False),
    sa.Column('event_severity', sa.String(length=20), nullable=False),
    sa.Column('event_data', sa.JSON(), nullable=False),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=255), nullable=True),
    sa.Column('session_id', sa.String(length=100), nullable=True),
    sa.Column('anomaly_score', sa.Float(), nullable=True),
    sa.Column('manipulation_indicators', sa.JSON(), nullable=True),
    sa.Column('security_flags', sa.JSON(), nullable=True),
    sa.Column('action_taken', sa.String(length=100), nullable=True),
    sa.Column('notification_sent', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_aria_security_anomaly', 'aria_security_logs', ['anomaly_score'], unique=False)
    op.create_index('idx_aria_security_player_time', 'aria_security_logs', ['player_id', 'created_at'], unique=False)
    op.create_index('idx_aria_security_severity', 'aria_security_logs', ['event_severity'], unique=False)
    op.create_table('aria_trading_patterns',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('pattern_id', sa.String(length=100), nullable=False),
    sa.Column('pattern_type', sa.String(length=50), nullable=False),
    sa.Column('pattern_dna', sa.JSON(), nullable=False),
    sa.Column('generation', sa.Integer(), nullable=True),
    sa.Column('parent_pattern', sa.String(length=100), nullable=True),
    sa.Column('mutations', sa.JSON(), nullable=True),
    sa.Column('times_used', sa.Integer(), nullable=True),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('average_profit', sa.Float(), nullable=True),
    sa.Column('best_profit', sa.Float(), nullable=True),
    sa.Column('worst_loss', sa.Float(), nullable=True),
    sa.Column('fitness_score', sa.Float(), nullable=True),
    sa.Column('survival_probability', sa.Float(), nullable=True),
    sa.Column('discovered_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_used', sa.DateTime(timezone=True), nullable=True),
    sa.Column('evolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id', 'pattern_id', name='uq_player_pattern')
    )
    op.create_index('idx_aria_pattern_player_fitness', 'aria_trading_patterns', ['player_id', 'fitness_score'], unique=False)
    op.create_table('combat_stats',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('total_combats', sa.Integer(), nullable=False),
    sa.Column('ship_combats', sa.Integer(), nullable=False),
    sa.Column('port_attacks', sa.Integer(), nullable=False),
    sa.Column('planet_defenses', sa.Integer(), nullable=False),
    sa.Column('attacker_wins', sa.Integer(), nullable=False),
    sa.Column('defender_wins', sa.Integer(), nullable=False),
    sa.Column('draws', sa.Integer(), nullable=False),
    sa.Column('escapes', sa.Integer(), nullable=False),
    sa.Column('total_credits_looted', sa.Integer(), nullable=False),
    sa.Column('total_cargo_looted_value', sa.Integer(), nullable=False),
    sa.Column('average_loot_per_combat', sa.Float(), nullable=False),
    sa.Column('total_drones_lost', sa.Integer(), nullable=False),
    sa.Column('average_combat_duration', sa.Float(), nullable=False),
    sa.Column('most_effective_ship_type', sa.String(length=50), nullable=True),
    sa.Column('most_active_attacker_id', sa.UUID(), nullable=True),
    sa.Column('most_active_defender_id', sa.UUID(), nullable=True),
    sa.Column('unique_combatants', sa.Integer(), nullable=False),
    sa.Column('calculated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['most_active_attacker_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['most_active_defender_id'], ['players.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('date')
    )
    op.create_table('event_templates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('event_type', sa.Enum('ECONOMIC', 'COMBAT', 'EXPLORATION', 'SEASONAL', 'EMERGENCY', 'STORY', name='eventtype'), nullable=False),
    sa.Column('default_duration_hours', sa.Integer(), nullable=False),
    sa.Column('default_effects', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('default_rewards', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=False),
    sa.Column('created_by', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_system_template', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('faction_missions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('faction_id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('mission_type', sa.String(length=50), nullable=False),
    sa.Column('min_reputation', sa.Integer(), nullable=True),
    sa.Column('min_level', sa.Integer(), nullable=True),
    sa.Column('credit_reward', sa.Integer(), nullable=True),
    sa.Column('reputation_reward', sa.Integer(), nullable=True),
    sa.Column('item_rewards', sa.ARRAY(sa.String()), nullable=True),
    sa.Column('target_sector_id', sa.UUID(), nullable=True),
    sa.Column('cargo_type', sa.String(length=50), nullable=True),
    sa.Column('cargo_quantity', sa.Integer(), nullable=True),
    sa.Column('target_faction_id', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.Integer(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['faction_id'], ['factions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_faction_missions_faction_id'), 'faction_missions', ['faction_id'], unique=False)
    op.create_table('first_login_sessions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('ai_service_used', sa.Boolean(), nullable=False),
    sa.Column('fallback_to_rules', sa.Boolean(), nullable=False),
    sa.Column('ship_claimed', sa.Enum('SCOUT_SHIP', 'CARGO_HAULER', 'ESCAPE_POD', 'LIGHT_FREIGHTER', 'DEFENDER', 'FAST_COURIER', 'COLONY_SHIP', 'CARRIER', name='ship_choice'), nullable=True),
    sa.Column('extracted_player_name', sa.String(), nullable=True),
    sa.Column('negotiation_skill', sa.Enum('WEAK', 'AVERAGE', 'STRONG', name='negotiation_skill_level'), nullable=True),
    sa.Column('final_persuasion_score', sa.Float(), nullable=True),
    sa.Column('outcome', sa.Enum('SUCCESS', 'PARTIAL_SUCCESS', 'FAILURE', name='dialogue_outcome'), nullable=True),
    sa.Column('awarded_ship', sa.Enum('SCOUT_SHIP', 'CARGO_HAULER', 'ESCAPE_POD', 'LIGHT_FREIGHTER', 'DEFENDER', 'FAST_COURIER', 'COLONY_SHIP', 'CARRIER', name='awarded_ship_type'), nullable=True),
    sa.Column('starting_credits', sa.Integer(), nullable=True),
    sa.Column('negotiation_bonus_flag', sa.Boolean(), nullable=True),
    sa.Column('notoriety_penalty', sa.Boolean(), nullable=True),
    sa.Column('client_info', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('performance_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('game_events',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('event_type', sa.Enum('ECONOMIC', 'COMBAT', 'EXPLORATION', 'SEASONAL', 'EMERGENCY', 'STORY', name='eventtype'), nullable=False),
    sa.Column('status', sa.Enum('SCHEDULED', 'ACTIVE', 'COMPLETED', 'CANCELLED', 'PAUSED', name='eventstatus'), nullable=False),
    sa.Column('start_time', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_time', sa.DateTime(timezone=True), nullable=False),
    sa.Column('actual_start_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('actual_end_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('affected_regions', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('affected_sectors', postgresql.ARRAY(sa.Integer()), nullable=True),
    sa.Column('global_event', sa.Boolean(), nullable=False),
    sa.Column('participation_requirements', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('rewards', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('max_participants', sa.Integer(), nullable=True),
    sa.Column('participation_count', sa.Integer(), nullable=False),
    sa.Column('rewards_distributed', sa.Integer(), nullable=False),
    sa.Column('completion_rate', sa.Float(), nullable=False),
    sa.Column('created_by', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('auto_start', sa.Boolean(), nullable=False),
    sa.Column('auto_end', sa.Boolean(), nullable=False),
    sa.Column('repeatable', sa.Boolean(), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('admin_notes', sa.Text(), nullable=True),
    sa.Column('requires_approval', sa.Boolean(), nullable=False),
    sa.Column('approved_by', sa.UUID(), nullable=True),
    sa.Column('approved_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['approved_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('messages',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('sender_id', sa.UUID(), nullable=False),
    sa.Column('recipient_id', sa.UUID(), nullable=True),
    sa.Column('team_id', sa.UUID(), nullable=True),
    sa.Column('subject', sa.String(length=255), nullable=True),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('sent_at', sa.DateTime(), nullable=False),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_sender', sa.Boolean(), nullable=True),
    sa.Column('deleted_by_recipient', sa.Boolean(), nullable=True),
    sa.Column('thread_id', sa.UUID(), nullable=True),
    sa.Column('reply_to_id', sa.UUID(), nullable=True),
    sa.Column('message_type', sa.String(length=20), nullable=False),
    sa.Column('priority', sa.String(length=10), nullable=True),
    sa.Column('flagged', sa.Boolean(), nullable=True),
    sa.Column('flagged_reason', sa.String(length=255), nullable=True),
    sa.Column('moderated_at', sa.DateTime(), nullable=True),
    sa.Column('moderated_by', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['moderated_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['recipient_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['reply_to_id'], ['messages.id'], ),
    sa.ForeignKeyConstraint(['sender_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_messages_recipient_id'), 'messages', ['recipient_id'], unique=False)
    op.create_index('ix_messages_recipient_read', 'messages', ['recipient_id', 'read_at'], unique=False)
    op.create_index(op.f('ix_messages_sender_id'), 'messages', ['sender_id'], unique=False)
    op.create_index(op.f('ix_messages_sent_at'), 'messages', ['sent_at'], unique=False)
    op.create_index(op.f('ix_messages_team_id'), 'messages', ['team_id'], unique=False)
    op.create_index('ix_messages_team_sent', 'messages', ['team_id', 'sent_at'], unique=False)
    op.create_index('ix_messages_thread', 'messages', ['thread_id', 'sent_at'], unique=False)
    op.create_index(op.f('ix_messages_thread_id'), 'messages', ['thread_id'], unique=False)
    op.create_table('mfa_attempts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('code_entered', sa.String(length=10), nullable=False),
    sa.Column('success', sa.Boolean(), nullable=False),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('attempt_time', sa.DateTime(), nullable=False),
    sa.Column('failure_reason', sa.String(length=100), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('mfa_secrets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('secret', sa.String(length=32), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('backup_codes', sa.String(length=500), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('verified_at', sa.DateTime(), nullable=True),
    sa.Column('last_used', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_table('oauth_accounts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('provider', sa.String(length=20), nullable=False),
    sa.Column('provider_user_id', sa.String(length=255), nullable=False),
    sa.Column('provider_account_email', sa.String(length=255), nullable=True),
    sa.Column('provider_account_username', sa.String(length=255), nullable=True),
    sa.Column('access_token', sa.String(), nullable=True),
    sa.Column('refresh_token', sa.String(), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('deleted', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('provider', 'provider_user_id')
    )
    op.create_table('planet_formations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('genesis_device_id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.Integer(), nullable=False),
    sa.Column('original_conditions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('estimated_duration', sa.Integer(), nullable=False),
    sa.Column('current_phase', sa.Integer(), nullable=False),
    sa.Column('total_phases', sa.Integer(), nullable=False),
    sa.Column('is_completed', sa.Boolean(), nullable=False),
    sa.Column('is_failed', sa.Boolean(), nullable=False),
    sa.Column('failure_reason', sa.String(), nullable=True),
    sa.Column('resulting_planet_id', sa.UUID(), nullable=True),
    sa.Column('formation_log', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('anomalies', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['genesis_device_id'], ['genesis_devices.id'], ),
    sa.ForeignKeyConstraint(['resulting_planet_id'], ['planets.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('player_credentials',
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('last_password_change', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('user_id')
    )
    op.create_table('player_planets',
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('planet_id', sa.UUID(), nullable=False),
    sa.Column('acquired_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['planet_id'], ['planets.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('player_id', 'planet_id')
    )
    op.create_table('refresh_tokens',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('token', sa.String(), nullable=False),
    sa.Column('revoked', sa.Boolean(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_refresh_tokens_id'), 'refresh_tokens', ['id'], unique=False)
    op.create_index(op.f('ix_refresh_tokens_token'), 'refresh_tokens', ['token'], unique=True)
    op.create_table('regions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('display_name', sa.String(length=255), nullable=False),
    sa.Column('region_type', sa.String(length=50), nullable=False),
    sa.Column('owner_id', sa.UUID(), nullable=True),
    sa.Column('subscription_tier', sa.String(length=50), nullable=False),
    sa.Column('paypal_subscription_id', sa.String(length=255), nullable=True),
    sa.Column('subscription_status', sa.String(length=50), nullable=True),
    sa.Column('subscription_started_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('subscription_expires_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('last_payment_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('next_billing_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('governance_type', sa.String(length=50), nullable=False),
    sa.Column('voting_threshold', sa.DECIMAL(precision=3, scale=2), nullable=False),
    sa.Column('election_frequency_days', sa.Integer(), nullable=False),
    sa.Column('constitutional_text', sa.Text(), nullable=True),
    sa.Column('tax_rate', sa.DECIMAL(precision=5, scale=4), nullable=False),
    sa.Column('trade_bonuses', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('economic_specialization', sa.String(length=50), nullable=True),
    sa.Column('starting_credits', sa.Integer(), nullable=False),
    sa.Column('starting_ship', sa.String(length=50), nullable=False),
    sa.Column('language_pack', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('aesthetic_theme', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('traditions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('social_hierarchy', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('nexus_warp_gate_sector', sa.Integer(), nullable=True),
    sa.Column('total_sectors', sa.Integer(), nullable=False),
    sa.Column('active_players_30d', sa.Integer(), nullable=False),
    sa.Column('total_trade_volume', sa.DECIMAL(precision=20, scale=2), nullable=False),
    sa.CheckConstraint("(region_type != 'central_nexus' OR total_sectors = 5000) AND (region_type != 'terran_space' OR total_sectors = 300) AND (region_type != 'player_owned' OR (total_sectors >= 100 AND total_sectors <= 1000))", name='valid_region_type_sector_count'),
    sa.CheckConstraint('election_frequency_days >= 30 AND election_frequency_days <= 365', name='valid_election_frequency'),
    sa.CheckConstraint('starting_credits >= 100', name='valid_starting_credits'),
    sa.CheckConstraint('tax_rate >= 0.05 AND tax_rate <= 0.25', name='valid_tax_rate'),
    sa.CheckConstraint('voting_threshold >= 0.1 AND voting_threshold <= 0.9', name='valid_voting_threshold'),
    sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_regions_name'), 'regions', ['name'], unique=True)
    op.create_table('reputations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('faction_id', sa.UUID(), nullable=False),
    sa.Column('current_value', sa.Integer(), nullable=False),
    sa.Column('current_level', sa.Enum('PUBLIC_ENEMY', 'CRIMINAL', 'OUTLAW', 'PIRATE', 'SMUGGLER', 'UNTRUSTWORTHY', 'SUSPICIOUS', 'QUESTIONABLE', 'NEUTRAL', 'RECOGNIZED', 'ACKNOWLEDGED', 'TRUSTED', 'RESPECTED', 'VALUED', 'HONORED', 'REVERED', 'EXALTED', name='reputation_level'), nullable=False),
    sa.Column('title', sa.String(length=50), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('decay_paused', sa.Boolean(), nullable=False),
    sa.Column('history', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('trade_modifier', sa.Float(), nullable=False),
    sa.Column('mission_availability', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('port_access_level', sa.Integer(), nullable=False),
    sa.Column('combat_response', sa.String(length=50), nullable=False),
    sa.Column('is_locked', sa.Boolean(), nullable=False),
    sa.Column('lock_reason', sa.String(length=255), nullable=True),
    sa.Column('lock_expires', sa.DateTime(timezone=True), nullable=True),
    sa.Column('special_status', sa.String(length=50), nullable=True),
    sa.ForeignKeyConstraint(['faction_id'], ['factions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sqlite_autoincrement=True
    )
    op.create_table('team_members',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('role', sa.String(length=20), nullable=False),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('permissions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('can_invite', sa.Boolean(), nullable=False),
    sa.Column('can_kick', sa.Boolean(), nullable=False),
    sa.Column('can_manage_treasury', sa.Boolean(), nullable=False),
    sa.Column('can_manage_missions', sa.Boolean(), nullable=False),
    sa.Column('can_manage_alliances', sa.Boolean(), nullable=False),
    sa.Column('last_active', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('contribution_credits', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('team_reputations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('calculation_method', sa.String(length=20), nullable=False),
    sa.Column('faction_reputation', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('history', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('last_recalculated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('next_recalculation', sa.DateTime(timezone=True), nullable=False),
    sa.Column('pending_notifications', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('team_id')
    )
    op.create_table('translation_keys',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('key', sa.String(length=200), nullable=False),
    sa.Column('language_id', sa.Integer(), nullable=False),
    sa.Column('namespace_id', sa.Integer(), nullable=False),
    sa.Column('value', sa.Text(), nullable=False),
    sa.Column('context', sa.Text(), nullable=True),
    sa.Column('pluralization_rule', sa.String(length=50), nullable=True),
    sa.Column('interpolation_vars', sa.Text(), nullable=True),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['language_id'], ['languages.id'], ),
    sa.ForeignKeyConstraint(['namespace_id'], ['translation_namespaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_namespace_language', 'translation_keys', ['namespace_id', 'language_id'], unique=False)
    op.create_index('idx_translation_lookup', 'translation_keys', ['key', 'language_id', 'namespace_id'], unique=False)
    op.create_index(op.f('ix_translation_keys_key'), 'translation_keys', ['key'], unique=False)
    op.create_index(op.f('ix_translation_keys_language_id'), 'translation_keys', ['language_id'], unique=False)
    op.create_index(op.f('ix_translation_keys_namespace_id'), 'translation_keys', ['namespace_id'], unique=False)
    op.create_table('translation_progress',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('language_id', sa.Integer(), nullable=False),
    sa.Column('namespace_id', sa.Integer(), nullable=False),
    sa.Column('total_keys', sa.Integer(), nullable=False),
    sa.Column('translated_keys', sa.Integer(), nullable=False),
    sa.Column('verified_keys', sa.Integer(), nullable=False),
    sa.Column('completion_percentage', sa.Integer(), nullable=False),
    sa.Column('last_updated', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['language_id'], ['languages.id'], ),
    sa.ForeignKeyConstraint(['namespace_id'], ['translation_namespaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_progress_unique', 'translation_progress', ['language_id', 'namespace_id'], unique=True)
    op.create_index(op.f('ix_translation_progress_language_id'), 'translation_progress', ['language_id'], unique=False)
    op.create_index(op.f('ix_translation_progress_namespace_id'), 'translation_progress', ['namespace_id'], unique=False)
    op.create_table('user_language_preferences',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('language_id', sa.Integer(), nullable=False),
    sa.Column('detected_language', sa.String(length=10), nullable=True),
    sa.Column('manual_override', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['language_id'], ['languages.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_language_preferences_language_id'), 'user_language_preferences', ['language_id'], unique=False)
    op.create_index(op.f('ix_user_language_preferences_user_id'), 'user_language_preferences', ['user_id'], unique=True)
    op.create_table('ai_conversation_logs',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('assistant_id', sa.UUID(), nullable=False),
    sa.Column('session_id', sa.UUID(), nullable=False),
    sa.Column('conversation_type', sa.String(length=30), nullable=False),
    sa.Column('interaction_sequence', sa.Integer(), nullable=False),
    sa.Column('privacy_level', sa.String(length=20), nullable=False),
    sa.Column('data_retention_days', sa.Integer(), nullable=False),
    sa.Column('user_input_sanitized', sa.Text(), nullable=False),
    sa.Column('input_intent', sa.String(length=50), nullable=True),
    sa.Column('input_confidence', sa.Numeric(precision=4, scale=3), nullable=True),
    sa.Column('ai_response_text', sa.Text(), nullable=False),
    sa.Column('response_type', sa.String(length=30), nullable=False),
    sa.Column('response_confidence', sa.Numeric(precision=4, scale=3), nullable=False),
    sa.Column('response_time_ms', sa.Integer(), nullable=False),
    sa.Column('conversation_context', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('ai_state_snapshot', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('user_satisfaction', sa.Integer(), nullable=True),
    sa.Column('follow_up_action_taken', sa.Boolean(), nullable=True),
    sa.Column('learning_value', sa.String(length=20), nullable=True),
    sa.Column('interaction_timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('ip_address_hash', sa.String(length=64), nullable=True),
    sa.Column('user_agent_hash', sa.String(length=64), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint("conversation_type IN ('query', 'command', 'feedback', 'learning', 'strategic')", name='valid_conversation_type'),
    sa.CheckConstraint("learning_value IS NULL OR learning_value IN ('none', 'low', 'medium', 'high', 'critical')", name='valid_learning_value'),
    sa.CheckConstraint("privacy_level IN ('public', 'standard', 'private', 'confidential')", name='valid_privacy_level'),
    sa.CheckConstraint("response_type IN ('answer', 'question', 'recommendation', 'error', 'clarification')", name='valid_response_type'),
    sa.CheckConstraint('data_retention_days >= 30 AND data_retention_days <= 2555', name='valid_retention_days'),
    sa.CheckConstraint('input_confidence IS NULL OR input_confidence >= 0.0 AND input_confidence <= 1.0', name='valid_input_confidence'),
    sa.CheckConstraint('interaction_sequence > 0', name='positive_interaction_sequence'),
    sa.CheckConstraint('length(ai_response_text) <= 8000', name='response_length_limit'),
    sa.CheckConstraint('length(user_input_sanitized) <= 4000', name='input_length_limit'),
    sa.CheckConstraint('response_confidence >= 0.0 AND response_confidence <= 1.0', name='valid_response_confidence'),
    sa.CheckConstraint('response_time_ms > 0', name='positive_response_time'),
    sa.CheckConstraint('user_satisfaction IS NULL OR user_satisfaction >= 1 AND user_satisfaction <= 5', name='valid_user_satisfaction'),
    sa.ForeignKeyConstraint(['assistant_id'], ['ai_comprehensive_assistants.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_conversations_retention', 'ai_conversation_logs', ['interaction_timestamp'], unique=False)
    op.create_index('idx_conversations_session', 'ai_conversation_logs', ['session_id', 'interaction_sequence'], unique=False)
    op.create_table('ai_cross_system_knowledge',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('assistant_id', sa.UUID(), nullable=False),
    sa.Column('knowledge_domain', sa.String(length=30), nullable=False),
    sa.Column('knowledge_type', sa.String(length=50), nullable=False),
    sa.Column('knowledge_subtype', sa.String(length=50), nullable=True),
    sa.Column('security_classification', sa.String(length=20), nullable=False),
    sa.Column('data_sensitivity', sa.String(length=20), nullable=False),
    sa.Column('knowledge_data', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('encrypted_knowledge', postgresql.BYTEA(), nullable=True),
    sa.Column('confidence_score', sa.Numeric(precision=4, scale=3), nullable=False),
    sa.Column('validation_count', sa.Integer(), nullable=False),
    sa.Column('accuracy_score', sa.Numeric(precision=4, scale=3), nullable=True),
    sa.Column('knowledge_timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('expiry_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_validated', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('data_source', sa.String(length=50), nullable=False),
    sa.Column('source_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.CheckConstraint("data_sensitivity IN ('low', 'medium', 'high', 'critical')", name='valid_data_sensitivity'),
    sa.CheckConstraint("knowledge_domain IN ('trading', 'combat', 'colony', 'port', 'strategic', 'social')", name='valid_knowledge_domain'),
    sa.CheckConstraint("security_classification IN ('public', 'internal', 'restricted', 'confidential')", name='valid_security_classification'),
    sa.CheckConstraint('accuracy_score IS NULL OR accuracy_score >= 0.0 AND accuracy_score <= 1.0', name='valid_accuracy_score'),
    sa.CheckConstraint('confidence_score >= 0.0 AND confidence_score <= 1.0', name='valid_confidence_score'),
    sa.CheckConstraint('validation_count >= 0', name='positive_validation_count'),
    sa.ForeignKeyConstraint(['assistant_id'], ['ai_comprehensive_assistants.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_knowledge_domain_confidence', 'ai_cross_system_knowledge', ['knowledge_domain', sa.literal_column('confidence_score DESC'), sa.literal_column('created_at DESC')], unique=False)
    op.create_index('idx_knowledge_security_level', 'ai_cross_system_knowledge', ['security_classification', 'data_sensitivity'], unique=False)
    op.create_table('ai_learning_patterns',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('assistant_id', sa.UUID(), nullable=False),
    sa.Column('pattern_category', sa.String(length=30), nullable=False),
    sa.Column('pattern_name', sa.String(length=100), nullable=False),
    sa.Column('pattern_version', sa.Integer(), nullable=False),
    sa.Column('pattern_description', sa.Text(), nullable=False),
    sa.Column('pattern_data', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('pattern_conditions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('confidence_score', sa.Numeric(precision=4, scale=3), nullable=False),
    sa.Column('validation_attempts', sa.Integer(), nullable=False),
    sa.Column('successful_validations', sa.Integer(), nullable=False),
    sa.Column('application_count', sa.Integer(), nullable=False),
    sa.Column('last_applied', sa.DateTime(timezone=True), nullable=True),
    sa.Column('security_classification', sa.String(length=20), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deactivated_reason', sa.Text(), nullable=True),
    sa.Column('discovered_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_validated', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint("pattern_category IN ('behavioral', 'market', 'tactical', 'strategic', 'social')", name='valid_pattern_category'),
    sa.CheckConstraint("security_classification IN ('public', 'internal', 'restricted', 'confidential')", name='valid_security_classification'),
    sa.CheckConstraint('application_count >= 0', name='positive_application_count'),
    sa.CheckConstraint('confidence_score >= 0.0 AND confidence_score <= 1.0', name='valid_confidence_score'),
    sa.CheckConstraint('length(pattern_description) <= 2000', name='description_length_limit'),
    sa.CheckConstraint('pattern_version > 0', name='positive_pattern_version'),
    sa.CheckConstraint('successful_validations <= validation_attempts', name='success_validation_bounds'),
    sa.CheckConstraint('validation_attempts >= 0', name='positive_validation_attempts'),
    sa.ForeignKeyConstraint(['assistant_id'], ['ai_comprehensive_assistants.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assistant_id', 'pattern_name', 'pattern_version', name='unique_pattern_version')
    )
    op.create_index('idx_patterns_active', 'ai_learning_patterns', ['assistant_id', 'pattern_category'], unique=False)
    op.create_table('ai_security_audit_log',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('assistant_id', sa.UUID(), nullable=True),
    sa.Column('player_id', sa.UUID(), nullable=True),
    sa.Column('event_type', sa.String(length=50), nullable=False),
    sa.Column('severity_level', sa.String(length=20), nullable=False),
    sa.Column('event_description', sa.Text(), nullable=False),
    sa.Column('event_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('security_context', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('ip_address_hash', sa.String(length=64), nullable=True),
    sa.Column('user_agent_hash', sa.String(length=64), nullable=True),
    sa.Column('session_id', sa.UUID(), nullable=True),
    sa.Column('detection_method', sa.String(length=50), nullable=True),
    sa.Column('automated_response', sa.String(length=100), nullable=True),
    sa.Column('requires_investigation', sa.Boolean(), nullable=False),
    sa.Column('investigation_status', sa.String(length=20), nullable=True),
    sa.Column('event_timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint("event_type IN ('access', 'data_access', 'recommendation', 'pattern_learning', 'security_violation', 'quota_exceeded')", name='valid_event_type'),
    sa.CheckConstraint("investigation_status IS NULL OR investigation_status IN ('pending', 'in_progress', 'resolved', 'false_positive')", name='valid_investigation_status'),
    sa.CheckConstraint("severity_level IN ('info', 'warning', 'error', 'critical')", name='valid_severity_level'),
    sa.CheckConstraint('length(event_description) <= 1000', name='description_length_limit'),
    sa.ForeignKeyConstraint(['assistant_id'], ['ai_comprehensive_assistants.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_audit_investigation', 'ai_security_audit_log', ['requires_investigation', 'investigation_status', sa.literal_column('created_at DESC')], unique=False)
    op.create_index('idx_audit_security_events', 'ai_security_audit_log', ['event_type', 'severity_level', sa.literal_column('event_timestamp DESC')], unique=False)
    op.create_table('ai_strategic_recommendations',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('assistant_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('recommendation_category', sa.String(length=30), nullable=False),
    sa.Column('recommendation_type', sa.String(length=50), nullable=False),
    sa.Column('priority_level', sa.Integer(), nullable=False),
    sa.Column('security_clearance_required', sa.String(length=20), nullable=False),
    sa.Column('compliance_flags', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('recommendation_title', sa.String(length=200), nullable=False),
    sa.Column('recommendation_summary', sa.Text(), nullable=False),
    sa.Column('detailed_analysis', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('risk_assessment', sa.String(length=20), nullable=False),
    sa.Column('expected_outcome', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('confidence_interval', sa.Numeric(precision=4, scale=3), nullable=False),
    sa.Column('presented_to_user', sa.Boolean(), nullable=False),
    sa.Column('user_response', sa.String(length=20), nullable=True),
    sa.Column('user_feedback_score', sa.Integer(), nullable=True),
    sa.Column('user_feedback_text', sa.Text(), nullable=True),
    sa.Column('outcome_tracked', sa.Boolean(), nullable=False),
    sa.Column('actual_outcome', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('outcome_accuracy', sa.Numeric(precision=4, scale=3), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('user_responded_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('outcome_recorded_at', sa.DateTime(timezone=True), nullable=True),
    sa.CheckConstraint("recommendation_category IN ('trading', 'combat', 'colony', 'port', 'strategic', 'resource')", name='valid_recommendation_category'),
    sa.CheckConstraint("risk_assessment IN ('very_low', 'low', 'medium', 'high', 'very_high')", name='valid_risk_assessment'),
    sa.CheckConstraint("security_clearance_required IN ('basic', 'standard', 'premium', 'enterprise')", name='valid_security_clearance'),
    sa.CheckConstraint("user_response IS NULL OR user_response IN ('accepted', 'rejected', 'modified', 'deferred')", name='valid_user_response'),
    sa.CheckConstraint('confidence_interval >= 0.0 AND confidence_interval <= 1.0', name='valid_confidence_interval'),
    sa.CheckConstraint('expires_at > created_at', name='valid_expiry'),
    sa.CheckConstraint('length(recommendation_summary) <= 1000', name='summary_length_limit'),
    sa.CheckConstraint('outcome_accuracy IS NULL OR outcome_accuracy >= 0.0 AND outcome_accuracy <= 1.0', name='valid_outcome_accuracy'),
    sa.CheckConstraint('priority_level >= 1 AND priority_level <= 5', name='valid_priority_level'),
    sa.CheckConstraint('user_feedback_score IS NULL OR user_feedback_score >= 1 AND user_feedback_score <= 5', name='valid_feedback_score'),
    sa.CheckConstraint('user_feedback_text IS NULL OR length(user_feedback_text) <= 2000', name='feedback_length_limit'),
    sa.ForeignKeyConstraint(['assistant_id'], ['ai_comprehensive_assistants.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_recommendations_active', 'ai_strategic_recommendations', ['player_id', 'recommendation_category', sa.literal_column('created_at DESC')], unique=False)
    op.create_index('idx_recommendations_expiry', 'ai_strategic_recommendations', ['expires_at'], unique=False)
    op.create_table('clusters',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.Enum('STANDARD', 'RESOURCE_RICH', 'POPULATION_CENTER', 'TRADE_HUB', 'MILITARY_ZONE', 'FRONTIER_OUTPOST', 'CONTESTED', 'SPECIAL_INTEREST', name='cluster_type'), nullable=False),
    sa.Column('sector_count', sa.Integer(), nullable=False),
    sa.Column('is_discovered', sa.Boolean(), nullable=False),
    sa.Column('discovery_requirement', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('stats', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('resource_modifiers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('economic_focus', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('resources', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('economic_value', sa.Integer(), nullable=False),
    sa.Column('controlling_faction', sa.String(), nullable=True),
    sa.Column('faction_influence', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('nav_hazards', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('recommended_ship_class', sa.String(), nullable=False),
    sa.Column('x_coord', sa.Integer(), nullable=False),
    sa.Column('y_coord', sa.Integer(), nullable=False),
    sa.Column('z_coord', sa.Integer(), nullable=False),
    sa.Column('special_features', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('is_hidden', sa.Boolean(), nullable=False),
    sa.Column('warp_stability', sa.Float(), nullable=False),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('dialogue_exchanges',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('session_id', sa.UUID(), nullable=False),
    sa.Column('sequence_number', sa.Integer(), nullable=False),
    sa.Column('npc_prompt', sa.String(), nullable=False),
    sa.Column('player_response', sa.String(), nullable=False),
    sa.Column('timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('topic', sa.String(), nullable=True),
    sa.Column('persuasiveness', sa.Float(), nullable=True),
    sa.Column('confidence', sa.Float(), nullable=True),
    sa.Column('consistency', sa.Float(), nullable=True),
    sa.Column('key_extracted_info', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('detected_contradictions', sa.ARRAY(sa.String()), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['first_login_sessions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('event_effects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('event_id', sa.UUID(), nullable=False),
    sa.Column('effect_type', sa.String(length=50), nullable=False),
    sa.Column('target', sa.String(length=100), nullable=False),
    sa.Column('modifier', sa.Float(), nullable=False),
    sa.Column('duration_hours', sa.Integer(), nullable=True),
    sa.Column('sector_ids', postgresql.ARRAY(sa.Integer()), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('effect_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('applied_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['event_id'], ['game_events.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('event_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('event_id', sa.UUID(), nullable=False),
    sa.Column('action', sa.String(length=100), nullable=False),
    sa.Column('details', sa.Text(), nullable=True),
    sa.Column('log_metadata', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('actor_type', sa.String(length=20), nullable=False),
    sa.Column('actor_id', sa.UUID(), nullable=True),
    sa.Column('logged_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['event_id'], ['game_events.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('event_participations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('event_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_activity', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('objectives_completed', sa.Integer(), nullable=False),
    sa.Column('total_objectives', sa.Integer(), nullable=False),
    sa.Column('progress_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('rewards_earned', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('rewards_claimed', sa.Boolean(), nullable=False),
    sa.Column('claimed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('score', sa.Integer(), nullable=False),
    sa.Column('rank', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['event_id'], ['game_events.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('inter_regional_travels',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('source_region_id', sa.UUID(), nullable=False),
    sa.Column('destination_region_id', sa.UUID(), nullable=False),
    sa.Column('travel_method', sa.String(length=50), nullable=False),
    sa.Column('travel_cost', sa.Integer(), nullable=False),
    sa.Column('assets_transferred', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('initiated_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('completed_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.CheckConstraint('source_region_id != destination_region_id', name='different_regions'),
    sa.CheckConstraint('travel_cost >= 0', name='non_negative_cost'),
    sa.ForeignKeyConstraint(['destination_region_id'], ['regions.id'], ),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['source_region_id'], ['regions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('player_first_login_states',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('has_completed_first_login', sa.Boolean(), nullable=False),
    sa.Column('current_session_id', sa.UUID(), nullable=True),
    sa.Column('attempts', sa.Integer(), nullable=False),
    sa.Column('last_attempt_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('claimed_ship', sa.Boolean(), nullable=False),
    sa.Column('answered_questions', sa.Boolean(), nullable=False),
    sa.Column('received_resources', sa.Boolean(), nullable=False),
    sa.Column('tutorial_started', sa.Boolean(), nullable=False),
    sa.Column('previous_ship_claims', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('previous_dialogue_strategies', sa.ARRAY(sa.String()), nullable=False),
    sa.ForeignKeyConstraint(['current_session_id'], ['first_login_sessions.id'], ),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id')
    )
    op.create_table('regional_elections',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=False),
    sa.Column('position', sa.String(length=50), nullable=False),
    sa.Column('candidates', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('voting_opens_at', sa.TIMESTAMP(), nullable=False),
    sa.Column('voting_closes_at', sa.TIMESTAMP(), nullable=False),
    sa.Column('results', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.CheckConstraint('voting_closes_at > voting_opens_at', name='valid_election_period'),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('regional_memberships',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=False),
    sa.Column('membership_type', sa.String(length=50), nullable=False),
    sa.Column('reputation_score', sa.Integer(), nullable=False),
    sa.Column('local_rank', sa.String(length=50), nullable=True),
    sa.Column('voting_power', sa.DECIMAL(precision=5, scale=4), nullable=False),
    sa.Column('joined_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_visit', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('total_visits', sa.Integer(), nullable=False),
    sa.CheckConstraint('reputation_score >= -1000 AND reputation_score <= 1000', name='valid_reputation'),
    sa.CheckConstraint('voting_power >= 0.0 AND voting_power <= 5.0', name='valid_voting_power'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id', 'region_id', name='unique_membership')
    )
    op.create_table('regional_policies',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=False),
    sa.Column('policy_type', sa.String(length=50), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('proposed_changes', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('proposed_by', sa.UUID(), nullable=False),
    sa.Column('proposed_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('voting_closes_at', sa.TIMESTAMP(), nullable=False),
    sa.Column('votes_for', sa.Integer(), nullable=False),
    sa.Column('votes_against', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.CheckConstraint('votes_against >= 0', name='non_negative_votes_against'),
    sa.CheckConstraint('votes_for >= 0', name='non_negative_votes_for'),
    sa.CheckConstraint('voting_closes_at > proposed_at', name='valid_voting_period'),
    sa.ForeignKeyConstraint(['proposed_by'], ['players.id'], ),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('regional_treaties',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('region_a_id', sa.UUID(), nullable=False),
    sa.Column('region_b_id', sa.UUID(), nullable=False),
    sa.Column('treaty_type', sa.String(length=50), nullable=False),
    sa.Column('terms', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('signed_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.Column('expires_at', sa.TIMESTAMP(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.CheckConstraint('region_a_id != region_b_id', name='different_treaty_regions'),
    sa.ForeignKeyConstraint(['region_a_id'], ['regions.id'], ),
    sa.ForeignKeyConstraint(['region_b_id'], ['regions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('region_a_id', 'region_b_id', 'treaty_type', name='unique_treaty')
    )
    op.create_table('ship_presentation_options',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('session_id', sa.UUID(), nullable=False),
    sa.Column('available_ships', sa.ARRAY(sa.String()), nullable=False),
    sa.Column('escape_pod_present', sa.Boolean(), nullable=False),
    sa.Column('rarity_roll', sa.Integer(), nullable=False),
    sa.Column('special_event_active', sa.Boolean(), nullable=False),
    sa.Column('seed_value', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['first_login_sessions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('translation_audit_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('translation_key_id', sa.Integer(), nullable=False),
    sa.Column('old_value', sa.Text(), nullable=True),
    sa.Column('new_value', sa.Text(), nullable=False),
    sa.Column('changed_by', sa.UUID(), nullable=True),
    sa.Column('change_reason', sa.String(length=200), nullable=True),
    sa.Column('is_automated', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['changed_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['translation_key_id'], ['translation_keys.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_translation_audit_logs_translation_key_id'), 'translation_audit_logs', ['translation_key_id'], unique=False)
    op.create_table('zones',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('zone_type', sa.String(length=50), nullable=False),
    sa.Column('start_sector', sa.Integer(), nullable=False),
    sa.Column('end_sector', sa.Integer(), nullable=False),
    sa.Column('policing_level', sa.Integer(), nullable=False, comment='Policing intensity: 0=lawless, 10=maximum security'),
    sa.Column('danger_rating', sa.Integer(), nullable=False, comment='Danger level: 0=completely safe, 10=extremely dangerous'),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.CheckConstraint('danger_rating >= 0 AND danger_rating <= 10', name='check_danger_range'),
    sa.CheckConstraint('end_sector >= start_sector', name='check_end_after_start'),
    sa.CheckConstraint('policing_level >= 0 AND policing_level <= 10', name='check_policing_range'),
    sa.CheckConstraint('start_sector >= 1', name='check_start_sector_positive'),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_zones_region_id'), 'zones', ['region_id'], unique=False)
    op.create_table('regional_votes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('election_id', sa.UUID(), nullable=False),
    sa.Column('voter_id', sa.UUID(), nullable=False),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('weight', sa.DECIMAL(precision=5, scale=4), nullable=False),
    sa.Column('cast_at', sa.TIMESTAMP(), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint('weight >= 0.0 AND weight <= 5.0', name='valid_vote_weight'),
    sa.ForeignKeyConstraint(['candidate_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['election_id'], ['regional_elections.id'], ),
    sa.ForeignKeyConstraint(['voter_id'], ['players.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('election_id', 'voter_id', name='one_vote_per_election')
    )
    op.create_table('sectors',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.Integer(), nullable=False),
    sa.Column('sector_number', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=True),
    sa.Column('security_level', sa.Integer(), nullable=True),
    sa.Column('development_level', sa.Integer(), nullable=True),
    sa.Column('traffic_level', sa.Integer(), nullable=True),
    sa.Column('cluster_id', sa.UUID(), nullable=False),
    sa.Column('zone_id', sa.UUID(), nullable=True),
    sa.Column('type', sa.Enum('STANDARD', 'NEBULA', 'ASTEROID_FIELD', 'BLACK_HOLE', 'STAR_CLUSTER', 'VOID', 'INDUSTRIAL', 'AGRICULTURAL', 'FORBIDDEN', 'WORMHOLE', name='sector_type'), nullable=False),
    sa.Column('is_discovered', sa.Boolean(), nullable=False),
    sa.Column('discovered_by_id', sa.UUID(), nullable=True),
    sa.Column('discovery_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('x_coord', sa.Integer(), nullable=False),
    sa.Column('y_coord', sa.Integer(), nullable=False),
    sa.Column('z_coord', sa.Integer(), nullable=False),
    sa.Column('radiation_level', sa.Float(), nullable=False),
    sa.Column('hazard_level', sa.Integer(), nullable=False),
    sa.Column('resources', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('resource_regeneration', sa.Float(), nullable=False),
    sa.Column('players_present', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('ships_present', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('defenses', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('controlling_faction', sa.String(), nullable=True),
    sa.Column('controlling_team_id', sa.UUID(), nullable=True),
    sa.Column('last_combat', sa.DateTime(timezone=True), nullable=True),
    sa.Column('active_events', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('special_features', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('nav_hazards', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('nav_beacons', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['cluster_id'], ['clusters.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['controlling_team_id'], ['teams.id'], ),
    sa.ForeignKeyConstraint(['discovered_by_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    sa.ForeignKeyConstraint(['zone_id'], ['zones.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('sector_id')
    )
    op.create_index(op.f('ix_sectors_zone_id'), 'sectors', ['zone_id'], unique=False)
    op.create_table('ai_market_predictions',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('commodity_id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.UUID(), nullable=False),
    sa.Column('predicted_price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('confidence_interval', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('prediction_horizon', sa.Integer(), nullable=False),
    sa.Column('model_version', sa.String(length=50), nullable=False),
    sa.Column('training_data_points', sa.Integer(), nullable=False),
    sa.Column('prediction_factors', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('actual_price', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('accuracy_score', sa.Numeric(precision=3, scale=2), nullable=True),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ai_training_data',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('data_type', sa.String(length=50), nullable=False),
    sa.Column('sector_id', sa.UUID(), nullable=True),
    sa.Column('commodity_id', sa.UUID(), nullable=True),
    sa.Column('timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('data_value', sa.Numeric(precision=12, scale=4), nullable=False),
    sa.Column('contextual_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('quality_score', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('used_in_training', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('aria_exploration_maps',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.UUID(), nullable=False),
    sa.Column('first_visit', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_visit', sa.DateTime(timezone=True), nullable=True),
    sa.Column('visit_count', sa.Integer(), nullable=True),
    sa.Column('ports_discovered', sa.JSON(), nullable=True),
    sa.Column('warp_tunnels_mapped', sa.JSON(), nullable=True),
    sa.Column('hazards_identified', sa.JSON(), nullable=True),
    sa.Column('market_volatility', sa.Float(), nullable=True),
    sa.Column('safety_rating', sa.Float(), nullable=True),
    sa.Column('trade_opportunity_score', sa.Float(), nullable=True),
    sa.Column('strategic_notes', sa.Text(), nullable=True),
    sa.Column('last_analysis', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id', 'sector_id', name='uq_player_sector_exploration')
    )
    op.create_index('idx_aria_exploration_player_sector', 'aria_exploration_maps', ['player_id', 'sector_id'], unique=False)
    op.create_table('drones',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=True),
    sa.Column('drone_type', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=True),
    sa.Column('level', sa.Integer(), nullable=False),
    sa.Column('health', sa.Integer(), nullable=False),
    sa.Column('max_health', sa.Integer(), nullable=False),
    sa.Column('attack_power', sa.Integer(), nullable=False),
    sa.Column('defense_power', sa.Integer(), nullable=False),
    sa.Column('speed', sa.Float(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=True),
    sa.Column('deployed_at', sa.DateTime(), nullable=True),
    sa.Column('last_action', sa.DateTime(), nullable=True),
    sa.Column('kills', sa.Integer(), nullable=False),
    sa.Column('damage_dealt', sa.Integer(), nullable=False),
    sa.Column('damage_taken', sa.Integer(), nullable=False),
    sa.Column('battles_fought', sa.Integer(), nullable=False),
    sa.Column('abilities', sa.String(length=255), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('destroyed_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_drones_player_id'), 'drones', ['player_id'], unique=False)
    op.create_index(op.f('ix_drones_sector_id'), 'drones', ['sector_id'], unique=False)
    op.create_index(op.f('ix_drones_team_id'), 'drones', ['team_id'], unique=False)
    op.create_table('fleets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('team_id', sa.UUID(), nullable=False),
    sa.Column('commander_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('formation', sa.String(length=50), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=True),
    sa.Column('total_ships', sa.Integer(), nullable=False),
    sa.Column('total_firepower', sa.Integer(), nullable=False),
    sa.Column('total_shields', sa.Integer(), nullable=False),
    sa.Column('total_hull', sa.Integer(), nullable=False),
    sa.Column('average_speed', sa.Float(), nullable=False),
    sa.Column('morale', sa.Integer(), nullable=False),
    sa.Column('supply_level', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('disbanded_at', sa.DateTime(), nullable=True),
    sa.Column('last_battle', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['commander_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_fleets_sector_id'), 'fleets', ['sector_id'], unique=False)
    op.create_index(op.f('ix_fleets_team_id'), 'fleets', ['team_id'], unique=False)
    op.create_table('player_trading_profiles',
    sa.Column('id', sa.UUID(), server_default=sa.text('gen_random_uuid()'), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('risk_tolerance', sa.Numeric(precision=3, scale=2), nullable=False),
    sa.Column('preferred_commodities', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('avoided_sectors', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('trading_patterns', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('performance_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('ai_assistance_level', sa.String(length=20), nullable=False),
    sa.Column('notification_preferences', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('learning_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('last_active_sector', sa.UUID(), nullable=True),
    sa.Column('average_profit_per_trade', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('total_trades_analyzed', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['last_active_sector'], ['sectors.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id')
    )
    op.create_table('sector_warps',
    sa.Column('source_sector_id', sa.UUID(), nullable=False),
    sa.Column('destination_sector_id', sa.UUID(), nullable=False),
    sa.Column('is_bidirectional', sa.Boolean(), nullable=False),
    sa.Column('turn_cost', sa.Integer(), nullable=False),
    sa.Column('warp_stability', sa.Float(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['destination_sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['source_sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('source_sector_id', 'destination_sector_id')
    )
    op.create_table('stations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('sector_id', sa.Integer(), nullable=False),
    sa.Column('sector_uuid', sa.UUID(), nullable=True),
    sa.Column('owner_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('station_class', sa.Enum('CLASS_0', 'CLASS_1', 'CLASS_2', 'CLASS_3', 'CLASS_4', 'CLASS_5', 'CLASS_6', 'CLASS_7', 'CLASS_8', 'CLASS_9', 'CLASS_10', 'CLASS_11', name='station_class'), nullable=False),
    sa.Column('type', sa.Enum('TRADING', 'MILITARY', 'INDUSTRIAL', 'MINING', 'SCIENTIFIC', 'SHIPYARD', 'OUTPOST', 'BLACK_MARKET', 'DIPLOMATIC', 'CORPORATE', name='station_type'), nullable=False),
    sa.Column('status', sa.Enum('OPERATIONAL', 'DAMAGED', 'UNDER_CONSTRUCTION', 'UNDER_ATTACK', 'LOCKDOWN', 'ABANDONED', 'RESTRICTED', name='station_status'), nullable=False),
    sa.Column('size', sa.Integer(), nullable=False),
    sa.Column('faction_affiliation', sa.String(), nullable=True),
    sa.Column('trade_volume', sa.Integer(), nullable=False),
    sa.Column('market_volatility', sa.Integer(), nullable=False),
    sa.Column('commodities', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('trader_personality', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('price_modifiers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('services', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('service_prices', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('defenses', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('ownership', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('last_market_update', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('market_update_frequency', sa.Integer(), nullable=False),
    sa.Column('reputation_threshold', sa.Integer(), nullable=False),
    sa.Column('is_quest_hub', sa.Boolean(), nullable=False),
    sa.Column('is_faction_headquarters', sa.Boolean(), nullable=False),
    sa.Column('is_player_ownable', sa.Boolean(), nullable=False),
    sa.Column('acquisition_requirements', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('last_attacked', sa.DateTime(timezone=True), nullable=True),
    sa.Column('is_destroyed', sa.Boolean(), nullable=False),
    sa.Column('recovery_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('active_events', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.Column('special_services', postgresql.ARRAY(sa.String()), nullable=False),
    sa.Column('region_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['region_id'], ['regions.id'], ),
    sa.ForeignKeyConstraint(['sector_uuid'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('warp_tunnels',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('origin_sector_id', sa.UUID(), nullable=False),
    sa.Column('destination_sector_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.Enum('NATURAL', 'ARTIFICIAL', 'STANDARD', 'QUANTUM', 'ANCIENT', 'UNSTABLE', 'ONE_WAY', name='warp_tunnel_type'), nullable=False),
    sa.Column('status', sa.Enum('ACTIVE', 'UNSTABLE', 'DEGRADING', 'COLLAPSED', 'MAINTENANCE', 'FORMING', name='warp_tunnel_status'), nullable=False),
    sa.Column('is_bidirectional', sa.Boolean(), nullable=False),
    sa.Column('stability', sa.Float(), nullable=False),
    sa.Column('stability_enum', sa.Enum('UNSTABLE', 'STABLE', name='warp_tunnel_stability_enum'), nullable=False),
    sa.Column('properties', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('tunnel_status', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('source_endpoint', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('destination_endpoint', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('artificial_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('total_traversals', sa.Integer(), nullable=False),
    sa.Column('traversal_history', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('turn_cost', sa.Integer(), nullable=False),
    sa.Column('energy_cost', sa.Integer(), nullable=False),
    sa.Column('is_public', sa.Boolean(), nullable=False),
    sa.Column('access_requirements', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_by_player_id', sa.UUID(), nullable=True),
    sa.Column('created_by_faction', sa.String(), nullable=True),
    sa.Column('max_uses', sa.Integer(), nullable=True),
    sa.Column('current_uses', sa.Integer(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('special_effects', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('description', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['created_by_player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['destination_sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['origin_sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('aria_market_intelligence',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('price_observations', sa.JSON(), nullable=True),
    sa.Column('average_price', sa.Float(), nullable=True),
    sa.Column('price_volatility', sa.Float(), nullable=True),
    sa.Column('identified_patterns', sa.JSON(), nullable=True),
    sa.Column('pattern_confidence', sa.JSON(), nullable=True),
    sa.Column('price_trend', sa.String(length=20), nullable=True),
    sa.Column('next_prediction', sa.Float(), nullable=True),
    sa.Column('prediction_confidence', sa.Float(), nullable=True),
    sa.Column('prediction_timestamp', sa.DateTime(timezone=True), nullable=True),
    sa.Column('trades_executed', sa.Integer(), nullable=True),
    sa.Column('successful_trades', sa.Integer(), nullable=True),
    sa.Column('total_profit', sa.Float(), nullable=True),
    sa.Column('data_points', sa.Integer(), nullable=True),
    sa.Column('last_visit', sa.DateTime(timezone=True), nullable=True),
    sa.Column('intelligence_quality', sa.Float(), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('player_id', 'port_id', 'commodity', name='uq_player_port_commodity')
    )
    op.create_index('idx_aria_intel_player_location', 'aria_market_intelligence', ['player_id', 'sector_id', 'commodity'], unique=False)
    op.create_index('idx_aria_intel_quality', 'aria_market_intelligence', ['intelligence_quality'], unique=False)
    op.create_table('aria_quantum_cache',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('cache_key', sa.String(length=255), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=False),
    sa.Column('quantum_states', sa.JSON(), nullable=False),
    sa.Column('ghost_results', sa.JSON(), nullable=False),
    sa.Column('expected_value', sa.Float(), nullable=False),
    sa.Column('confidence_interval', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('hit_count', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_quantum_cache_expiry', 'aria_quantum_cache', ['expires_at'], unique=False)
    op.create_index('idx_quantum_cache_player_key', 'aria_quantum_cache', ['player_id', 'cache_key'], unique=False)
    op.create_table('combat_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('attacker_id', sa.UUID(), nullable=True),
    sa.Column('defender_id', sa.UUID(), nullable=True),
    sa.Column('attacker_ship_id', sa.UUID(), nullable=True),
    sa.Column('defender_ship_id', sa.UUID(), nullable=True),
    sa.Column('attacker_ship_name', sa.String(length=100), nullable=True),
    sa.Column('defender_ship_name', sa.String(length=100), nullable=True),
    sa.Column('attacker_ship_type', sa.String(length=50), nullable=True),
    sa.Column('defender_ship_type', sa.String(length=50), nullable=True),
    sa.Column('sector_id', sa.Integer(), nullable=True),
    sa.Column('sector_uuid', sa.UUID(), nullable=True),
    sa.Column('port_id', sa.UUID(), nullable=True),
    sa.Column('planet_id', sa.UUID(), nullable=True),
    sa.Column('combat_type', sa.String(length=50), nullable=False),
    sa.Column('outcome', sa.String(length=20), nullable=False),
    sa.Column('attacker_drones', sa.Integer(), nullable=False),
    sa.Column('defender_drones', sa.Integer(), nullable=False),
    sa.Column('attacker_attack_drones', sa.Integer(), nullable=False),
    sa.Column('attacker_defense_drones', sa.Integer(), nullable=False),
    sa.Column('defender_attack_drones', sa.Integer(), nullable=False),
    sa.Column('defender_defense_drones', sa.Integer(), nullable=False),
    sa.Column('attacker_damage_dealt', sa.Integer(), nullable=False),
    sa.Column('defender_damage_dealt', sa.Integer(), nullable=False),
    sa.Column('attacker_drones_lost', sa.Integer(), nullable=False),
    sa.Column('defender_drones_lost', sa.Integer(), nullable=False),
    sa.Column('credits_looted', sa.Integer(), nullable=False),
    sa.Column('cargo_looted', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('experience_gained', sa.Integer(), nullable=False),
    sa.Column('combat_duration', sa.Float(), nullable=False),
    sa.Column('rounds', sa.Integer(), nullable=False),
    sa.Column('combat_log', sa.Text(), nullable=True),
    sa.Column('timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('ended_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('admin_notes', sa.Text(), nullable=True),
    sa.Column('admin_resolved', sa.Boolean(), nullable=False),
    sa.Column('admin_resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('disputed', sa.Boolean(), nullable=False),
    sa.Column('resolved', sa.Boolean(), nullable=False),
    sa.Column('admin_reviewed', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['attacker_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['attacker_ship_id'], ['ships.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['defender_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['defender_ship_id'], ['ships.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['planet_id'], ['planets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['sector_uuid'], ['sectors.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('drone_combats',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('attacker_drone_id', sa.UUID(), nullable=True),
    sa.Column('defender_drone_id', sa.UUID(), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=False),
    sa.Column('ended_at', sa.DateTime(), nullable=True),
    sa.Column('rounds', sa.Integer(), nullable=True),
    sa.Column('winner_drone_id', sa.UUID(), nullable=True),
    sa.Column('attacker_damage_dealt', sa.Integer(), nullable=True),
    sa.Column('defender_damage_dealt', sa.Integer(), nullable=True),
    sa.Column('combat_log', sa.String(length=2000), nullable=True),
    sa.ForeignKeyConstraint(['attacker_drone_id'], ['drones.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['defender_drone_id'], ['drones.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('drone_deployments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('drone_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('sector_id', sa.UUID(), nullable=False),
    sa.Column('deployed_at', sa.DateTime(), nullable=False),
    sa.Column('recalled_at', sa.DateTime(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('deployment_type', sa.String(length=50), nullable=True),
    sa.Column('target_id', sa.UUID(), nullable=True),
    sa.Column('enemies_destroyed', sa.Integer(), nullable=True),
    sa.Column('resources_collected', sa.Integer(), nullable=True),
    sa.Column('damage_prevented', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['drone_id'], ['drones.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_drone_deployments_drone_id'), 'drone_deployments', ['drone_id'], unique=False)
    op.create_index(op.f('ix_drone_deployments_player_id'), 'drone_deployments', ['player_id'], unique=False)
    op.create_index(op.f('ix_drone_deployments_sector_id'), 'drone_deployments', ['sector_id'], unique=False)
    op.create_table('economic_metrics',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metric_type', sa.String(length=20), nullable=False),
    sa.Column('total_trade_volume', sa.Integer(), nullable=False),
    sa.Column('total_transactions', sa.Integer(), nullable=False),
    sa.Column('average_transaction_value', sa.Float(), nullable=False),
    sa.Column('total_credits_in_circulation', sa.Integer(), nullable=False),
    sa.Column('credits_in_player_accounts', sa.Integer(), nullable=False),
    sa.Column('credits_in_npc_accounts', sa.Integer(), nullable=False),
    sa.Column('credit_velocity', sa.Float(), nullable=False),
    sa.Column('economic_health_score', sa.Float(), nullable=False),
    sa.Column('inflation_rate', sa.Float(), nullable=False),
    sa.Column('average_profit_margin', sa.Float(), nullable=False),
    sa.Column('market_volatility', sa.Float(), nullable=False),
    sa.Column('most_traded_commodity', sa.String(length=50), nullable=True),
    sa.Column('least_traded_commodity', sa.String(length=50), nullable=True),
    sa.Column('commodity_price_index', sa.Float(), nullable=False),
    sa.Column('most_active_sector', sa.Integer(), nullable=True),
    sa.Column('most_valuable_port', sa.UUID(), nullable=True),
    sa.Column('economic_disparity_index', sa.Float(), nullable=False),
    sa.Column('richest_player_credits', sa.Integer(), nullable=False),
    sa.Column('median_player_credits', sa.Integer(), nullable=False),
    sa.Column('total_players_trading', sa.Integer(), nullable=False),
    sa.Column('new_traders', sa.Integer(), nullable=False),
    sa.Column('calculated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['most_valuable_port'], ['stations.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('date')
    )
    op.create_index('ix_economic_metrics_date', 'economic_metrics', ['date'], unique=False)
    op.create_index('ix_economic_metrics_type_date', 'economic_metrics', ['metric_type', 'date'], unique=False)
    op.create_table('enhanced_market_transactions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=True),
    sa.Column('port_id', sa.UUID(), nullable=True),
    sa.Column('transaction_type', sa.Enum('BUY', 'SELL', 'TRANSFER', 'ADMIN_ADJUSTMENT', name='transactiontype'), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('unit_price', sa.Integer(), nullable=False),
    sa.Column('total_value', sa.Integer(), nullable=False),
    sa.Column('port_buy_price', sa.Integer(), nullable=True),
    sa.Column('port_sell_price', sa.Integer(), nullable=True),
    sa.Column('port_quantity', sa.Integer(), nullable=True),
    sa.Column('sector_id', sa.Integer(), nullable=True),
    sa.Column('sector_uuid', sa.UUID(), nullable=True),
    sa.Column('timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('profit_margin', sa.Float(), nullable=True),
    sa.Column('market_impact', sa.Float(), nullable=True),
    sa.Column('admin_notes', sa.String(length=500), nullable=True),
    sa.Column('flagged_suspicious', sa.Boolean(), nullable=False),
    sa.Column('reviewed_by', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['reviewed_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['sector_uuid'], ['sectors.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_market_transactions_commodity', 'enhanced_market_transactions', ['commodity'], unique=False)
    op.create_index('ix_market_transactions_player_id', 'enhanced_market_transactions', ['player_id'], unique=False)
    op.create_index('ix_market_transactions_port_id', 'enhanced_market_transactions', ['port_id'], unique=False)
    op.create_index('ix_market_transactions_timestamp', 'enhanced_market_transactions', ['timestamp'], unique=False)
    op.create_table('fleet_battles',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('attacker_fleet_id', sa.UUID(), nullable=True),
    sa.Column('defender_fleet_id', sa.UUID(), nullable=True),
    sa.Column('sector_id', sa.UUID(), nullable=True),
    sa.Column('phase', sa.String(length=50), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=False),
    sa.Column('ended_at', sa.DateTime(), nullable=True),
    sa.Column('attacker_ships_initial', sa.Integer(), nullable=True),
    sa.Column('defender_ships_initial', sa.Integer(), nullable=True),
    sa.Column('winner', sa.String(length=20), nullable=True),
    sa.Column('attacker_ships_destroyed', sa.Integer(), nullable=True),
    sa.Column('defender_ships_destroyed', sa.Integer(), nullable=True),
    sa.Column('attacker_ships_retreated', sa.Integer(), nullable=True),
    sa.Column('defender_ships_retreated', sa.Integer(), nullable=True),
    sa.Column('total_damage_dealt', sa.Integer(), nullable=True),
    sa.Column('attacker_damage_dealt', sa.Integer(), nullable=True),
    sa.Column('defender_damage_dealt', sa.Integer(), nullable=True),
    sa.Column('battle_log', sa.JSON(), nullable=True),
    sa.Column('credits_looted', sa.Integer(), nullable=True),
    sa.Column('resources_looted', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['attacker_fleet_id'], ['fleets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['defender_fleet_id'], ['fleets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['sector_id'], ['sectors.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('fleet_members',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('fleet_id', sa.UUID(), nullable=False),
    sa.Column('ship_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('position', sa.Integer(), nullable=True),
    sa.Column('joined_at', sa.DateTime(), nullable=True),
    sa.Column('ready_status', sa.Boolean(), nullable=True),
    sa.ForeignKeyConstraint(['fleet_id'], ['fleets.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['ship_id'], ['ships.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_fleet_members_fleet_id'), 'fleet_members', ['fleet_id'], unique=False)
    op.create_index(op.f('ix_fleet_members_player_id'), 'fleet_members', ['player_id'], unique=False)
    op.create_index(op.f('ix_fleet_members_ship_id'), 'fleet_members', ['ship_id'], unique=False)
    op.create_table('market_prices',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('buy_price', sa.Integer(), nullable=False),
    sa.Column('sell_price', sa.Integer(), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('previous_buy_price', sa.Integer(), nullable=True),
    sa.Column('previous_sell_price', sa.Integer(), nullable=True),
    sa.Column('price_trend', sa.Float(), nullable=False),
    sa.Column('volatility', sa.Float(), nullable=False),
    sa.Column('demand_level', sa.Float(), nullable=False),
    sa.Column('supply_level', sa.Float(), nullable=False),
    sa.Column('last_transaction_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('daily_volume', sa.Integer(), nullable=False),
    sa.Column('price_floor', sa.Integer(), nullable=True),
    sa.Column('price_ceiling', sa.Integer(), nullable=True),
    sa.Column('alert_threshold', sa.Float(), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_market_prices_unique', 'market_prices', ['port_id', 'commodity'], unique=True)
    op.create_index('ix_market_prices_updated_at', 'market_prices', ['updated_at'], unique=False)
    op.create_table('markets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('last_updated', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=False),
    sa.Column('specialization', sa.String(), nullable=True),
    sa.Column('size', sa.Integer(), nullable=False),
    sa.Column('tax_rate', sa.Float(), nullable=False),
    sa.Column('economic_status', sa.String(), nullable=False),
    sa.Column('resource_availability', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('resource_prices', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('price_modifiers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('daily_volume', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('price_history', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('black_market', sa.Boolean(), nullable=False),
    sa.Column('special_offers', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.Column('trade_restrictions', postgresql.JSONB(astext_type=sa.Text()), nullable=False),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('player_stations',
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('station_id', sa.UUID(), nullable=False),
    sa.Column('acquired_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['station_id'], ['stations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('player_id', 'station_id')
    )
    op.create_table('price_alerts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('alert_type', sa.String(length=30), nullable=False),
    sa.Column('threshold_value', sa.Float(), nullable=False),
    sa.Column('current_value', sa.Float(), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('message', sa.String(length=500), nullable=False),
    sa.Column('suggested_action', sa.String(length=200), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('triggered_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('acknowledged_by', sa.UUID(), nullable=True),
    sa.Column('acknowledged_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('auto_resolve', sa.Boolean(), nullable=False),
    sa.Column('resolve_threshold', sa.Float(), nullable=True),
    sa.ForeignKeyConstraint(['acknowledged_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_price_alerts_active', 'price_alerts', ['is_active'], unique=False)
    op.create_index('ix_price_alerts_triggered', 'price_alerts', ['triggered_at'], unique=False)
    op.create_table('price_history',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('port_id', sa.UUID(), nullable=False),
    sa.Column('commodity', sa.String(length=50), nullable=False),
    sa.Column('buy_price', sa.Integer(), nullable=False),
    sa.Column('sell_price', sa.Integer(), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('daily_volume', sa.Integer(), nullable=False),
    sa.Column('transactions_count', sa.Integer(), nullable=False),
    sa.Column('average_transaction_size', sa.Float(), nullable=False),
    sa.Column('demand_level', sa.Float(), nullable=False),
    sa.Column('supply_level', sa.Float(), nullable=False),
    sa.Column('market_efficiency', sa.Float(), nullable=False),
    sa.Column('snapshot_date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('snapshot_type', sa.String(length=20), nullable=False),
    sa.ForeignKeyConstraint(['port_id'], ['stations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_price_history_date_commodity', 'price_history', ['snapshot_date', 'commodity'], unique=False)
    op.create_index('ix_price_history_port_date', 'price_history', ['port_id', 'snapshot_date'], unique=False)
    op.create_table('fleet_battle_casualties',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('battle_id', sa.UUID(), nullable=False),
    sa.Column('ship_id', sa.UUID(), nullable=True),
    sa.Column('player_id', sa.UUID(), nullable=True),
    sa.Column('fleet_id', sa.UUID(), nullable=True),
    sa.Column('ship_name', sa.String(length=100), nullable=True),
    sa.Column('ship_type', sa.String(length=50), nullable=True),
    sa.Column('was_attacker', sa.Boolean(), nullable=True),
    sa.Column('destroyed', sa.Boolean(), nullable=True),
    sa.Column('retreated', sa.Boolean(), nullable=True),
    sa.Column('damage_taken', sa.Integer(), nullable=True),
    sa.Column('damage_dealt', sa.Integer(), nullable=True),
    sa.Column('kills', sa.Integer(), nullable=True),
    sa.Column('casualty_time', sa.DateTime(), nullable=True),
    sa.Column('battle_phase', sa.String(length=50), nullable=True),
    sa.ForeignKeyConstraint(['battle_id'], ['fleet_battles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['fleet_id'], ['fleets.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['ship_id'], ['ships.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_fleet_battle_casualties_battle_id'), 'fleet_battle_casualties', ['battle_id'], unique=False)
    op.create_table('market_transactions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('timestamp', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('market_id', sa.UUID(), nullable=False),
    sa.Column('player_id', sa.UUID(), nullable=False),
    sa.Column('ship_id', sa.UUID(), nullable=True),
    sa.Column('is_purchase', sa.Boolean(), nullable=False),
    sa.Column('resource_type', sa.Enum('ORE', 'BASIC_FOOD', 'GOURMET_FOOD', 'FUEL', 'TECHNOLOGY', 'EXOTIC_TECHNOLOGY', 'LUXURY_GOODS', 'POPULATION', 'QUANTUM_SHARDS', 'QUANTUM_CRYSTALS', 'COMBAT_DRONES', 'PRISMATIC_ORE', 'PHOTONIC_CRYSTALS', name='resource_type'), nullable=False),
    sa.Column('resource_quality', sa.Enum('LOW', 'STANDARD', 'HIGH', 'PREMIUM', 'EXOTIC', name='resource_quality'), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('price_per_unit', sa.Integer(), nullable=False),
    sa.Column('total_price', sa.Integer(), nullable=False),
    sa.Column('tax_paid', sa.Integer(), nullable=False),
    sa.Column('negotiated_discount', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['market_id'], ['markets.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['player_id'], ['players.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['ship_id'], ['ships.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )

    # Add deferred FK constraints after all tables created (circular dependency fix)

    # genesis_devices FKs
    op.create_foreign_key('fk_genesis_devices_owner_id_players', 'genesis_devices', 'players', ['owner_id'], ['id'])
    op.create_foreign_key('fk_genesis_devices_planet_id_planets', 'genesis_devices', 'planets', ['planet_id'], ['id'])
    op.create_foreign_key('fk_genesis_devices_ship_id_ships', 'genesis_devices', 'ships', ['ship_id'], ['id'])

    # planets FKs
    op.create_foreign_key('fk_planets_genesis_device_id_genesis_devices', 'planets', 'genesis_devices', ['genesis_device_id'], ['id'])
    op.create_foreign_key('fk_planets_region_id_regions', 'planets', 'regions', ['region_id'], ['id'])
    op.create_foreign_key('fk_planets_sector_uuid_sectors', 'planets', 'sectors', ['sector_uuid'], ['id'], ondelete='CASCADE')

    # players FKs
    op.create_foreign_key('fk_players_current_region_id_regions', 'players', 'regions', ['current_region_id'], ['id'])
    op.create_foreign_key('fk_players_current_ship_id_ships', 'players', 'ships', ['current_ship_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key('fk_players_home_region_id_regions', 'players', 'regions', ['home_region_id'], ['id'])
    op.create_foreign_key('fk_players_team_id_teams', 'players', 'teams', ['team_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key('fk_players_user_id_users', 'players', 'users', ['user_id'], ['id'], ondelete='CASCADE')

    op.drop_table('_database_metadata')

    # Re-enable FK constraint checking
    op.execute("SET session_replication_role = 'origin';")
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('_database_metadata',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('key', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('value', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('_database_metadata_pkey')),
    sa.UniqueConstraint('key', name=op.f('_database_metadata_key_key'), postgresql_include=[], postgresql_nulls_not_distinct=False),
    comment='Store database metadata and configuration'
    )
    op.drop_table('market_transactions')
    op.drop_index(op.f('ix_fleet_battle_casualties_battle_id'), table_name='fleet_battle_casualties')
    op.drop_table('fleet_battle_casualties')
    op.drop_index('ix_price_history_port_date', table_name='price_history')
    op.drop_index('ix_price_history_date_commodity', table_name='price_history')
    op.drop_table('price_history')
    op.drop_index('ix_price_alerts_triggered', table_name='price_alerts')
    op.drop_index('ix_price_alerts_active', table_name='price_alerts')
    op.drop_table('price_alerts')
    op.drop_table('player_stations')
    op.drop_table('markets')
    op.drop_index('ix_market_prices_updated_at', table_name='market_prices')
    op.drop_index('ix_market_prices_unique', table_name='market_prices')
    op.drop_table('market_prices')
    op.drop_index(op.f('ix_fleet_members_ship_id'), table_name='fleet_members')
    op.drop_index(op.f('ix_fleet_members_player_id'), table_name='fleet_members')
    op.drop_index(op.f('ix_fleet_members_fleet_id'), table_name='fleet_members')
    op.drop_table('fleet_members')
    op.drop_table('fleet_battles')
    op.drop_index('ix_market_transactions_timestamp', table_name='enhanced_market_transactions')
    op.drop_index('ix_market_transactions_port_id', table_name='enhanced_market_transactions')
    op.drop_index('ix_market_transactions_player_id', table_name='enhanced_market_transactions')
    op.drop_index('ix_market_transactions_commodity', table_name='enhanced_market_transactions')
    op.drop_table('enhanced_market_transactions')
    op.drop_index('ix_economic_metrics_type_date', table_name='economic_metrics')
    op.drop_index('ix_economic_metrics_date', table_name='economic_metrics')
    op.drop_table('economic_metrics')
    op.drop_index(op.f('ix_drone_deployments_sector_id'), table_name='drone_deployments')
    op.drop_index(op.f('ix_drone_deployments_player_id'), table_name='drone_deployments')
    op.drop_index(op.f('ix_drone_deployments_drone_id'), table_name='drone_deployments')
    op.drop_table('drone_deployments')
    op.drop_table('drone_combats')
    op.drop_table('combat_logs')
    op.drop_index('idx_quantum_cache_player_key', table_name='aria_quantum_cache')
    op.drop_index('idx_quantum_cache_expiry', table_name='aria_quantum_cache')
    op.drop_table('aria_quantum_cache')
    op.drop_index('idx_aria_intel_quality', table_name='aria_market_intelligence')
    op.drop_index('idx_aria_intel_player_location', table_name='aria_market_intelligence')
    op.drop_table('aria_market_intelligence')
    op.drop_table('warp_tunnels')
    op.drop_table('stations')
    op.drop_table('sector_warps')
    op.drop_table('player_trading_profiles')
    op.drop_index(op.f('ix_fleets_team_id'), table_name='fleets')
    op.drop_index(op.f('ix_fleets_sector_id'), table_name='fleets')
    op.drop_table('fleets')
    op.drop_index(op.f('ix_drones_team_id'), table_name='drones')
    op.drop_index(op.f('ix_drones_sector_id'), table_name='drones')
    op.drop_index(op.f('ix_drones_player_id'), table_name='drones')
    op.drop_table('drones')
    op.drop_index('idx_aria_exploration_player_sector', table_name='aria_exploration_maps')
    op.drop_table('aria_exploration_maps')
    op.drop_table('ai_training_data')
    op.drop_table('ai_market_predictions')
    op.drop_index(op.f('ix_sectors_zone_id'), table_name='sectors')
    op.drop_table('sectors')
    op.drop_table('regional_votes')
    op.drop_index(op.f('ix_zones_region_id'), table_name='zones')
    op.drop_table('zones')
    op.drop_index(op.f('ix_translation_audit_logs_translation_key_id'), table_name='translation_audit_logs')
    op.drop_table('translation_audit_logs')
    op.drop_table('ship_presentation_options')
    op.drop_table('regional_treaties')
    op.drop_table('regional_policies')
    op.drop_table('regional_memberships')
    op.drop_table('regional_elections')
    op.drop_table('player_first_login_states')
    op.drop_table('inter_regional_travels')
    op.drop_table('event_participations')
    op.drop_table('event_logs')
    op.drop_table('event_effects')
    op.drop_table('dialogue_exchanges')
    op.drop_table('clusters')
    op.drop_index('idx_recommendations_expiry', table_name='ai_strategic_recommendations')
    op.drop_index('idx_recommendations_active', table_name='ai_strategic_recommendations')
    op.drop_table('ai_strategic_recommendations')
    op.drop_index('idx_audit_security_events', table_name='ai_security_audit_log')
    op.drop_index('idx_audit_investigation', table_name='ai_security_audit_log')
    op.drop_table('ai_security_audit_log')
    op.drop_index('idx_patterns_active', table_name='ai_learning_patterns')
    op.drop_table('ai_learning_patterns')
    op.drop_index('idx_knowledge_security_level', table_name='ai_cross_system_knowledge')
    op.drop_index('idx_knowledge_domain_confidence', table_name='ai_cross_system_knowledge')
    op.drop_table('ai_cross_system_knowledge')
    op.drop_index('idx_conversations_session', table_name='ai_conversation_logs')
    op.drop_index('idx_conversations_retention', table_name='ai_conversation_logs')
    op.drop_table('ai_conversation_logs')
    op.drop_index(op.f('ix_user_language_preferences_user_id'), table_name='user_language_preferences')
    op.drop_index(op.f('ix_user_language_preferences_language_id'), table_name='user_language_preferences')
    op.drop_table('user_language_preferences')
    op.drop_index(op.f('ix_translation_progress_namespace_id'), table_name='translation_progress')
    op.drop_index(op.f('ix_translation_progress_language_id'), table_name='translation_progress')
    op.drop_index('idx_progress_unique', table_name='translation_progress')
    op.drop_table('translation_progress')
    op.drop_index(op.f('ix_translation_keys_namespace_id'), table_name='translation_keys')
    op.drop_index(op.f('ix_translation_keys_language_id'), table_name='translation_keys')
    op.drop_index(op.f('ix_translation_keys_key'), table_name='translation_keys')
    op.drop_index('idx_translation_lookup', table_name='translation_keys')
    op.drop_index('idx_namespace_language', table_name='translation_keys')
    op.drop_table('translation_keys')
    op.drop_table('team_reputations')
    op.drop_table('team_members')
    op.drop_table('reputations')
    op.drop_index(op.f('ix_regions_name'), table_name='regions')
    op.drop_table('regions')
    op.drop_index(op.f('ix_refresh_tokens_token'), table_name='refresh_tokens')
    op.drop_index(op.f('ix_refresh_tokens_id'), table_name='refresh_tokens')
    op.drop_table('refresh_tokens')
    op.drop_table('player_planets')
    op.drop_table('player_credentials')
    op.drop_table('planet_formations')
    op.drop_table('oauth_accounts')
    op.drop_table('mfa_secrets')
    op.drop_table('mfa_attempts')
    op.drop_index(op.f('ix_messages_thread_id'), table_name='messages')
    op.drop_index('ix_messages_thread', table_name='messages')
    op.drop_index('ix_messages_team_sent', table_name='messages')
    op.drop_index(op.f('ix_messages_team_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_sent_at'), table_name='messages')
    op.drop_index(op.f('ix_messages_sender_id'), table_name='messages')
    op.drop_index('ix_messages_recipient_read', table_name='messages')
    op.drop_index(op.f('ix_messages_recipient_id'), table_name='messages')
    op.drop_table('messages')
    op.drop_table('game_events')
    op.drop_table('first_login_sessions')
    op.drop_index(op.f('ix_faction_missions_faction_id'), table_name='faction_missions')
    op.drop_table('faction_missions')
    op.drop_table('event_templates')
    op.drop_table('combat_stats')
    op.drop_index('idx_aria_pattern_player_fitness', table_name='aria_trading_patterns')
    op.drop_table('aria_trading_patterns')
    op.drop_index('idx_aria_security_severity', table_name='aria_security_logs')
    op.drop_index('idx_aria_security_player_time', table_name='aria_security_logs')
    op.drop_index('idx_aria_security_anomaly', table_name='aria_security_logs')
    op.drop_table('aria_security_logs')
    op.drop_index('idx_aria_memory_player_type', table_name='aria_personal_memories')
    op.drop_index('idx_aria_memory_importance', table_name='aria_personal_memories')
    op.drop_table('aria_personal_memories')
    op.drop_table('ai_recommendations')
    op.drop_table('ai_comprehensive_assistants')
    op.drop_table('admin_credentials')
    op.drop_table('users')
    op.drop_index(op.f('ix_translation_namespaces_name'), table_name='translation_namespaces')
    op.drop_table('translation_namespaces')
    op.drop_table('teams')
    op.drop_table('ships')
    op.drop_table('ship_specifications')
    op.drop_table('ship_rarity_configs')
    op.drop_table('resources')
    op.drop_table('players')
    op.drop_table('planets')
    op.drop_index(op.f('ix_languages_code'), table_name='languages')
    op.drop_table('languages')
    op.drop_table('genesis_devices')
    op.drop_table('galaxies')
    op.drop_index(op.f('ix_factions_name'), table_name='factions')
    op.drop_table('factions')
    op.drop_index(op.f('ix_audit_logs_user_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_timestamp'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_path'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_action'), table_name='audit_logs')
    op.drop_table('audit_logs')
    op.drop_table('ai_model_performance')
    # ### end Alembic commands ###